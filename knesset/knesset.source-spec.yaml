dump_to_db:
  pipeline-type: db dump


dump-presence-to-db:
  pipeline:
  - run: load_resource
    parameters:
      url: https://storage.googleapis.com/knesset-data-pipelines/data/members/presence/datapackage.json
      resource: presence
  - run: dump.to_sql
    parameters:
      # set the following env var to connect to oknesset DB from oknesset-db1 server
      # DPP_DB_ENGINE=postgresql://oknesset:${PGPASSWORD}@localhost:5432/oknesset
      engine: env://DPP_DB_ENGINE
      tables:
        next_mks_presence:
          resource-name: presence
          mode: rewrite


kns_knessetdates:
  pipeline-type: knesset dataservice
  schemas-bucket: "knesset"
  dataservice-parameters:
    resource-name: kns_knessetdates
    service-name: api
    method-name: "KNS_KnessetDates"
    fields:
      KnessetDateID:
        source: "{name}"
        type: integer
        description: מספר השורה בטבלה זו
      KnessetNum:
        source: "{name}"
        type: integer
        description: מספר הכנסת
      Name:
        source: "{name}"
        type: string
        description: שם הכנסת
      Assembly:
        source: "{name}"
        type: integer
        description: מספר המושב
      Plenum:
        source: "{name}"
        type: integer
        description: מספר הכנס (קיץ, חורף)
      PlenumStart:
        source: "{name}"
        type: datetime
        description: תאריך תחילה
      PlenumFinish:
        source: "{name}"
        type: datetime
        description: תאריך סיום
      IsCurrent:
        source: "{name}"
        type: boolean
        description: האם זו הכנסת הנוכחית?
      LastUpdatedDate:
        source: "{name}"
        type: datetime
        description: תאריך עדכון אחרון


dump_people:
  description: dump relevant data from https://github.com/orihoch/knesset-data-people
  pipeline:
  - run: load_resource
    parameters:
      url: https://storage.googleapis.com/knesset-data-pipelines/data/people/committees/meeting-attendees/datapackage.json
      resource: kns_committeesession
  - run: ..rename_resource
    parameters:
      src: kns_committeesession
      dst: committee_meeting_attendees
  - run: load_resource
    parameters:
      url: https://storage.googleapis.com/knesset-data-pipelines/data/people/committees/joined-meeting-attendees-mks/datapackage.json
      resource: kns_committeesession
  - run: ..rename_resource
    parameters:
      src: kns_committeesession
      dst: committee_meeting_attendees_mks
  - run: load_resource
    parameters:
      url: https://storage.googleapis.com/knesset-data-pipelines/data/people/committees/committee-meeting-attendees-mks-stats/datapackage.json
      resource: mk_attendance
  - run: dump.to_path
    parameters:
      out-path: ../data/people/all
  - run: dump.to_sql
    parameters:
      engine: env://DPP_DB_ENGINE
      tables:
        people_committee_meeting_attendees:
          resource-name: committee_meeting_attendees
        people_committee_meeting_attendees_mks:
          resource-name: committee_meeting_attendees_mks
        people_mk_attendance:
          resource-name: mk_attendance



all:
  pipeline-type: all package
  base-url: https://storage.googleapis.com/knesset-data-pipelines/data/knesset/
  resources:
  - name: kns_knessetdates
  out-path: ../data/knesset/all
  sql-tables-prefix: knesset
